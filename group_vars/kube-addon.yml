---

addon_images:
  # kubernetes dashboard
  dashboard:       "{{ images.dashboard.repos }}{{ images.dashboard.name }}:{{ images.dashboard.tag }}"
  # Kube-dns
  kubedns:         "{{ images.kubedns.repos }}{{ images.kubedns.name }}:{{ images.kubedns.tag }}"
  dnsmasq:         "{{ images.dnsmasq.repos }}{{ images.dnsmasq.name }}:{{ images.dnsmasq.tag }}"
  sidecar:         "{{ images.sidecar.repos }}{{ images.sidecar.name }}:{{ images.sidecar.tag }}"
  # Kubernetes monitor
  heapster:        "{{ images.heapster.repos }}{{ images.heapster.name }}:{{ images.heapster.tag }}"
  resizer:         "{{ images.resizer.repos }}{{ images.resizer.name }}:{{ images.resizer.tag }}"
  influxdb:        "{{ images.influxdb.repos }}{{ images.influxdb.name }}:{{ images.influxdb.tag }}"
  grafana:         "{{ images.grafana.repos }}{{ images.grafana.name }}:{{ images.grafana.tag }}"
  # Kubernetes logging
  elasticsearch:   "{{ images.elasticsearch.repos }}{{ images.elasticsearch.name }}:{{ images.elasticsearch.tag }}"
  fluentd:         "{{ images.fluentd.repos }}{{ images.fluentd.name }}:{{ images.fluentd.tag }}"
  kibana:          "{{ images.kibana.repos }}{{ images.kibana.name }}:{{ images.kibana.tag }}"
  # Ingress controller
  nginx_ingress:   "{{ images.nginx_ingress.repos }}{{ images.nginx_ingress.name }}:{{ images.nginx_ingress.tag }}"
  default_backend: "{{ images.default_backend.repos }}{{ images.default_backend.name }}:{{ images.default_backend.tag }}"
  traefik:         "{{ images.traefik.repos }}{{ images.traefik.name }}:{{ images.traefik.tag }}"
  # Kube-proxy
  kube_proxy:      "{{ images.kube_proxy.repos }}{{ images.kube_proxy.name }}:{{ images.kube_proxy.tag }}"
  nfs_client:      "{{ images.nfs_client.repos }}{{ images.nfs_client.name }}:{{ images.nfs_client.tag }}"
  # Prometheus
  prometheus:
    hyperkube:
      repos: quay.io/coreos/hyperkube
      tag: v1.7.6_coreos.0
    prometheus_config_reloader:
      repos: quay.io/coreos/prometheus-config-reloader
      tag: v0.20.0
    configmap_reload:
      repos: quay.io/coreos/configmap-reload
      tag: v0.0.1
    prometheus_operator:
      repos: quay.io/coreos/prometheus-operator
      tag: v0.20.0
    alertmanager:
      repos: quay.io/prometheus/alertmanager
      tag: v0.14.0
    prometheus:
      repos: quay.io/prometheus/prometheus
      tag: v2.2.1
    kube_state_metrics:
      repos: gcr.io/google_containers/kube-state-metrics
      tag: v1.2.0
    addon_resizer:
      repos: gcr.io/google_containers/addon-resizer
      tag: 1.7
    node_exporter:
      repos: quay.io/prometheus/node-exporter
      tag: v0.15.2
    grafana:
      repos: grafana/grafana
      tag: 5.0.0
    grafana_watcher:
      repos: quay.io/coreos/grafana-watcher
      tag: v0.0.8

# Kube-addons resources
num_nodes: "{{ groups['kube-cluster'] | length }}"
base_metrics_memory: 140Mi
base_metrics_cpu: 80m
base_eventer_memory: 190Mi
metrics_memory_per_node: 4
metrics_cpu_per_node: 0.5
eventer_memory_per_node: 500
nanny_memory_per_node: 200
nanny_memory: "{% if num_nodes >= 0 -%}{{ 90 * 1024 + num_nodes|int * nanny_memory_per_node}}Ki{%- else -%}90Mi{% endif -%}"
dashboard:
  requests:
    memory: 128Mi
    cpu: 100m
dns:
  kubedns:
    limits:
      memory: 170Mi
    requests:
      cpu: 100m
      memory: 70Mi
  dnsmasq:
    requests:
      cpu: 150m
      memory: 20Mi
  sidecar:
    requests:
      memory: 20Mi
      cpu: 10m
monitor:
  resizer:
    limits:
      cpu: 80m
      memory: "{{ nanny_memory }}"
    requests:
      cpu: 50m
      memory: "{{ nanny_memory }}"
  influxdb:
    limits:
      cpu: 200m
      memory: 500Mi
    requests:
      cpu: 100m
      memory: 250Mi
  grafana:
    limits:
      cpu: 200m
      memory: 200Mi
    requests:
      cpu: 100m
      memory: 100Mi
monitor_prometheus:
  prometheus_ingress_host: "prometheus.local.ai"
  grafana_ingress_host: "grafana.local.ai"
  ingress_auth_user: clustar
  ingress_auth_secret: Y2x1c3Rhcjp2eE4xdkJWSDBGb2pzCg==  # generated by: echo "clustar:$(openssl passwd -crypt 123456)" | base64
  prometheus_operator:
    limits:
      cpu: 200m
      memory: 100Mi
    requests:
      cpu: 100m
      memory: 50Mi
  alertmanager:
    storage_class_name: nfs
    storage_size: 20Gi
    limits:
      cpu: 400m
      memory: 400Mi
    requests:
      cpu: 200m
      memory: 200Mi
  prometheus:
    retention: 72h
    storage_class_name: nfs
    storage_size: 20Gi
    limits:
      cpu: 800m
      memory: 800Mi
    requests:
      cpu: 400m
      memory: 400Mi
  grafana:
    admin_user: clustar
    admin_pass: clustar@2018
    storage_class_name: nfs
    storage_size: 5Gi
    limits:
      cpu: 200m
      memory: 200Mi
    requests:
      cpu: 100m
      memory: 100Mi

logging:
  kibana:
    limits:
      cpu: 1000m
    requests:
      cpu: 100m
    ingress_host: "dev-kibana.local.ai"
    ingress_auth_user: clustar
    ingress_auth_secret: Y2x1c3Rhcjp2eE4xdkJWSDBGb2pzCg==  # generated by: echo "clustar:$(openssl passwd -crypt 123456)" | base64
  fluentd:
    limits:
      memory: 500Mi
    requests:
      cpu: 100m
      memory: 200Mi
  elasticsearch:
    max_map_count: 262144
    storage_class_name: "nfs"
    storage_size: "10Gi"
    limits:
      cpu: 500m
    requests:
      cpu: 100m
nginx_ingress:
  backend:
    limits:
      cpu: 10m
      memory: 20Mi
    requests:
      cpu: 10m
      memory: 20Mi
